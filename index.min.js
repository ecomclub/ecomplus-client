"use strict";var isNodeJs=false;if(typeof module!=="undefined"&&module.exports){isNodeJs=true}var EcomIo=function(){let storeId,https,loggerif(isNodeJs){https=require("https")}let runMethod=function(e,c,b,d,a){let pathif(!b){b="api.e-com.plus";path="/v1"}else{if(b!=="api.e-com.plus"){path="/api/v1"}}if(!d){d="GET"}let tries=0if(isNodeJs===true){let options={hostname:b,path:path+c,method:d,headers:{"Content-Type":"application/json","X-Store-ID":storeId}}let send=function(){let req=https.request(options,function(f){tries++;if(f.statusCode===503&&tries<3){setTimeout(function(){send()},500);f.resume();return}let rawData=""f.setEncoding("utf8");f.on("data",function(g){rawData+=g});f.on("end",function(){try{let a=JSON.parse(rawData)if(typeof e==="function"){let errif(f.statusCode===200){err=null}else{let msgif(a.hasOwnProperty("message")){msg=a.message}else{msg="Unknown error, see response objet to more info"}err=new Error(msg)}e(err,a)}else{return a}}catch(g){logger.error(g)}});req.on("error",function(g){logger.error(g)});if(a){req.write(JSON.stringify(a))}req.end()})}}else{let ajax=new XMLHttpRequest()let url="https://"+b+path+cajax.open(d,url,true);if(a){ajax.send(JSON.stringify(a))}else{ajax.send()}let tries=0let sendAjax=function(){tries++;ajax.onreadystatechange=function(){let a=JSON.parse(ajax.responseText)if(ajax.status===503&&tries<3){setTimeout(function(){sendAjax()},500)}try{if(typeof e==="function"){let errif(ajax.readyState===4&&ajax.status===200){err=null}else{let msgif(a.hasOwnProperty("message")){msg=a.message}else{msg="Unknown error, see response objet to more info"}err=new Error(msg)}e(err,a)}else{return a}}catch(f){logger.error(f)}}}}}return{init:function(b,a){storeId=b;if(typeof a==="object"&&a.hasOwnProperty("log")&&a.hasOwnProperty("error")){logger=a}else{logger=console}},storeId:storeId,getProductBySku:function(b,a){let response=runMethod(b,"/products.json?sku="+a).done(function(){for(let i=0;i<response.result;i++){EcomIo.getProduct(b,response.result[i]._id)}})},getProduct:function(b,a){runMethod(b,"/products/"+a+".json")},getOrder:function(b,a){runMethod(b,"/orders/"+a+".json")},getBrands:function(c,a){var b;if(!a){b="/brands.json"}else{b="/brands.json?"+a}runMethod(c,b)},getCategories:function(c,a){var b;if(!a){b="/categories.json"}else{b="/categories.json?"+a}runMethod(c,b)},searchProduts:function(h,c,b,d){var e="apx-search.e-com.plus";var g="POST";var f="/items.json";if(typeof b==="number"){switch(b){case 1:b={sales:"desc"};break;case 2:b={price:"asc"};break;case 3:b={price:"desc"};break;default:b={views:"desc"}}}else{if(typeof b!=="object"){b={views:"desc"}}}var a={query:{multi_match:{query:c,fields:["name","keywords"]},sort:[{available:true},"_score",{ad_relevance:"desc"},b],bool:{filter:[{term:{visible:true}}]}}};if(typeof d==="object"){for(let key in d){if(d.hasOwnProperty(key)){let propertyObject=d[key]for(let key2 in propertyObject){if(propertyObject.hasOwnProperty(key2)&&Array.isArray(propertyObject[key2])){for(let i=0;i<propertyObject[key2].length;i++){let bodytoFilter={term:{}}bodytoFilter.term[key]={};bodytoFilter.term[key][key2]=propertyObject[key2][i];a.bool.filter.push(bodytoFilter)}}}}}}runMethod(h,f,e,g,a)},getRecommendedProducts:function(b,a){let host="apx-graphs.e-com.plus"runMethod(b,"/products/"+a+"recommended.json",host)},getRelatedProducts:function(b,a){let host="apx-graphs.e-com.plus"runMethod(b,"/products/"+a+"related.json",host)}}};EcomIo=EcomIo();if(isNodeJs){module.exports=EcomIo};