"use strict";var isNodeJs=false;if(typeof module!=="undefined"&&module.exports){isNodeJs=true}var EcomIo=function(){var l,g,m,k;if(isNodeJs){m=require("https")}var d=function(o){return"E-Com Plus SDK "+o+":"};var f=function(r,p,q){if(typeof r==="function"){var o=new Error(p);if(q===undefined){r(o,null)}else{r(o,q)}}k.log(d("WARNING")+"\n"+p)};var c=function(u,t,p,o){var s;if(typeof u!=="function"){s="You need to specify a callback function to receive the request response";f(null,s);return}var q;if(!p){p="api.e-com.plus";q="/v1"}else{switch(p){case"ioapi.ecvol.com":case"api.e-com.plus":q="/v1";break;default:q="/api/v1"}}q+=t;var r=0;b(r,p,q,o,u);s=d("INFO")+"\nAPI endpoint\n"+t;k.log(s)};var b=function(t,v,w,q,u){var o;if(!q){o="GET"}else{o="POST"}if(t===1){switch(v){case"ioapi.ecvol.com":v="api.e-com.plus";break;case"io.ecvol.com":v="e-com.plus";break}}if(isNodeJs===true){var x={hostname:v,path:w,method:o,headers:{"Content-Type":"application/json","X-Store-ID":l}};var r=m.request(x,function(y){if(y.statusCode===503&&t<3){setTimeout(function(){b(t,v,w,q,u)},500);y.resume();return}var z="";y.setEncoding("utf8");y.on("data",function(A){z+=A});y.on("end",function(){e(y.statusCode,z,u)})});r.on("error",function(y){k.error(y);u(y,null)});if(q){r.write(JSON.stringify(q))}r.end()}else{var s;if(window.XDomainRequest){s=new XDomainRequest();s.ontimeout=s.onerror=function(){setTimeout(function(){b(t,v,w,q,u)},500)};s.onload=function(){e(200,this.responseText,u)}}else{s=new XMLHttpRequest();s.onreadystatechange=function(){if(this.readyState===4){if(this.status===503&&t<3){setTimeout(function(){b(t,v,w,q,u)},500);return}e(this.status,this.responseText,u)}}}var p="https://"+v+w;s.open(o,p,true);if(q){s.send(JSON.stringify(q))}else{s.send()}}t++};var e=function(p,r,t){var o;try{o=JSON.parse(r)}catch(q){k.error(q);t(q,null);return}if(p===200){t(null,o)}else{var s;if(o.hasOwnProperty("message")){s=o.message}else{s="Unknown error, see response objet to more info"}f(t,s,o)}};var j=function(q,p){var o;if(typeof p==="string"){if(p.match(/^[a-f0-9]{24}$/)){return true}else{o="ID must be a valid 24 hexadecimal digits string, lowercase only"}}else{o="ID is required and must be a string"}f(q,o);return false};var n=function(r,p,q){if(j(r,q)){var o="ioapi.ecvol.com";c(r,"/"+p+"/"+q+".json",o)}};var i=function(u,q,t,o,s,p){if(typeof q==="string"){c(function(x,v){if(!x){var w=v.result;if(Array.isArray(w)&&typeof w[0]==="object"&&w[0]!==null){p(u,w[0]._id)}else{var y="Any "+o+" found with this "+t;f(u,y,v)}}else{u(x,v)}},s)}else{var r="The"+t+" is required and must be a string";f(u,r)}};var h=function(v,o,r,q,s,t,p){var u=a(r,q,s,t,p);var x="/"+o+".json";var w;if(u===""){w="ioapi.ecvol.com"}else{x+=u}c(v,x,w)};var a=function(t,s,v,w,q){var r={};var x="";if(typeof q!=="string"){if(typeof t==="number"&&t>0){r.offset=t}if(typeof s==="number"&&s>0){r.limit=s}if(typeof v==="number"){switch(v){case 1:r.sort="name";break;case 2:r.sort="-name";break}}if(Array.isArray(w)){var o="";for(var u=0;u<w.length;u++){if(typeof w[u]==="string"){if(o!==""){o+="%2C"}o+=w[u]}}if(o!==""){r.fields=o}}for(var p in r){if(r.hasOwnProperty(p)){if(x!==""){x+="&"}x+=p+"="+r[p]}}}else{x=q}if(x!==""){x="?"+x}return x};return{init:function(v,s,p,q){if(typeof q==="object"&&q.hasOwnProperty("log")&&q.hasOwnProperty("error")){k=q}else{k=console}if(l){l=s;g=p;if(typeof v==="function"){v(null,null)}}else{if(!isNodeJs){var r="io.ecvol.com";var u="/domains/"+window.location.hostname+".json";var o=function(x,w){if(!x){l=w.store_id;g=w.store_object_id}if(typeof v==="function"){v(x,w)}};c(o,u,r)}else{var t="It is necessary to specify the store ID as an init argument";f(v,t)}}},storeId:function(){return l},storeObjectId:function(){return g},getStore:function(p,o){if(o===undefined&&g){o=g}n(p,"stores",o)},getProduct:function(p,o){n(p,"products",o)},getProductBySku:function(q,p){var o="/products.json?sku="+p;i(q,p,"SKU","product",o,EcomIo.getProduct)},getOrder:function(p,o){n(p,"orders",o)},getCart:function(p,o){n(p,"carts",o)},getCustomer:function(p,o){n(p,"customers",o)},getApplication:function(p,o){n(p,"applications",o)},getBrand:function(p,o){n(p,"brands",o)},findBrandBySlug:function(q,o){var p="/brands.json?limit=1&slug="+o;c(q,p)},listBrands:function(t,s,p,q,o,r){h(t,"brands",s,p,q,o,r)},getCategory:function(p,o){n(p,"categories",o)},findCategoryBySlug:function(q,o){var p="/categories.json?limit=1&slug="+o;c(q,p)},listCategories:function(t,s,p,q,o,r){h(t,"categories",s,p,q,o,r)},getCollection:function(p,o){n(p,"collections",o)},findCollectionBySlug:function(q,o){var p="/collections.json?limit=1&slug="+o;c(q,p)},listCollections:function(t,s,p,q,o,r){h(t,"collections",s,p,q,o,r)},getById:n,searchProduts:function(A,q,y,E,s,p,D,u,r,x){var C="apx-search.e-com.plus";var B="/items.json";var v,o;if(typeof x==="object"&&x!==null){v=x}else{if(typeof s==="number"){switch(s){case 1:s={sales:"desc"};break;case 2:s={price:"asc"};break;case 3:s={price:"desc"};break;default:s={views:"desc"}}}else{if(!s){s={views:"desc"}}}v={query:{sort:[{available:true},"_score",{ad_relevance:"desc"},s],bool:{filter:[{term:{visible:true}}]}},aggs:{brands:{terms:{field:"brands.name"}},categories:{terms:{field:"categories.name"}},specs:{nested:{path:"specs"},aggs:{grid:{terms:{field:"specs.grid",size:12},aggs:{text:{terms:{field:"specs.text"}}}}}},min_price:{min:{field:"price"}},max_price:{max:{field:"price"}},avg_price:{avg:{field:"price"}}}};if(typeof q==="string"){v.query.multi_match={query:q,fields:["name","keywords"]}}if(typeof y==="number"&&y>0){v.from=y}if(typeof E==="number"&&E>0){v.size=E}else{v.size=24}if(typeof p==="object"&&p!==null&&Object.keys(p).length>0){var w={nested:{path:"specs",query:{bool:{filter:[]}}}};for(var z in p){if(Array.isArray(p[z])&&p[z].length>0){w.nested.query.bool.filter.push({term:{"specs.grid":z}},{terms:{"specs.text":p[z]}});v.query.bool.filter.push(w)}}}if(Array.isArray(D)&&D.length>0){v.query.bool.filter.push({terms:{"brands.name":D}})}if(Array.isArray(u)&&u.length>0){v.query.bool.filter.push({terms:{"categories.name":u}})}if(typeof r==="object"&&r!==null&&Object.keys(r).length>0){var t={range:{price:{}}};if(typeof r.min==="number"&&!isNaN(r.min)){t.range.price.gte=r.min}if(typeof r.max==="number"&&!isNaN(r.max)){t.range.price.lte=r.max}v.query.bool.filter.push(t)}}o=d("INFO")+"\nQuery DSL\n"+JSON.stringify(v);k.log(o);c(A,B,C,v)},mapBySlug:function(s,p){var q="iostorefront.ecvol.com";var r="/"+l+"+"+p.replace(/\//g,"+")+".json";var o=function(u,t){if(!u){var w=t.GET;if(w){w=w.split("+");t={resource:w[0],_id:w[1]};s(null,t)}else{t={status:404,error_code:-44,message:"Page not found, invalid slug or store ID"};var v=t.message;f(s,v,t)}}else{s(u,t)}};c(o,r,q)},mapByWindowUri:function(q){if(!isNodeJs){var o=window.location.pathname.slice(1);EcomIo.mapBySlug(q,o)}else{var p="This method is available client side only (JS on browser)";f(q,p)}},listRecommendedProducts:function(r,q){if(j(q)){var o="apx-graphs.e-com.plus";var p="/products/"+q+"/recommended.json";c(r,p,o)}},listRelatedProducts:function(r,q){if(j(q)){var o="apx-graphs.e-com.plus";var p="/products/"+q+"/related.json";c(r,p,o)}},http:c}};EcomIo=EcomIo();if(isNodeJs){module.exports=EcomIo};